(window["webpackJsonpreact-sn"]=window["webpackJsonpreact-sn"]||[]).push([[0],{12:function(e,t,n){"use strict";(function(e){var n=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(a,i){function o(e){try{s(r.next(e))}catch(t){i(t)}}function c(e){try{s(r.throw(e))}catch(t){i(t)}}function s(e){e.done?a(e.value):new n(function(t){t(e.value)}).then(o,c)}s((r=r.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(c){i=[6,c],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e){var t=e.token,n=e.instance;this.instance=n,this.endpoint="https://"+this.instance+".service-now.com",this.tableEndpoint="https://"+this.instance+".service-now.com/api/now/table",this.defaultHeaders=new Headers({"Content-Type":"application/json",Authorization:"Bearer "+t})}return e.prototype.handleResponse=function(e){return n(this,void 0,void 0,function(){var t,n;return r(this,function(r){switch(r.label){case 0:return e.ok?[4,e.json()]:[3,2];case 1:return[2,(t=r.sent()).result];case 2:return r.trys.push([2,4,,5]),[4,e.json()];case 3:return t=r.sent(),console.error("ServiceNow returned error "+e.status+":\n"+JSON.stringify(t,null,2)),[2,null];case 4:return n=r.sent(),console.error("Error attempting to parse response. \n"+n),[2,null];case 5:return[2]}})})},e.prototype.getRecords=function(e,t){var a=t.displayValue,i=void 0!==a&&a,o=t.excludeReferenceLink,c=void 0!==o&&o,s=t.fields,u=void 0===s?[]:s,l=t.limit,d=void 0===l?1e4:l,p=t.offset,f=void 0===p?0:p,h=t.query,v=void 0===h?"":h,m=t.queryNoDomain,y=void 0!==m&&m,b=t.suppressPaginationHeader,w=void 0!==b&&b,E=t.view,_=void 0===E?"":E;return n(this,void 0,void 0,function(){var t,n;return r(this,function(r){switch(r.label){case 0:return t=["sysparm_display_value="+i,"sysparm_exclude_reference_link="+c,"sysparm_fields="+u.join(),"sysparm_limit="+d,"sysparm_offset="+f,"sysparm_query="+v,"sysparm_query_no_domain="+y,"sysparm_suppress_pagination_header="+w,"sysparm_view="+_].join("&"),[4,fetch(this.tableEndpoint+"/"+e+"?"+t,{method:"GET",headers:this.defaultHeaders})];case 1:return n=r.sent(),[4,this.handleResponse(n)];case 2:return[2,r.sent()]}})})},e.prototype.getRecord=function(e,t,a){var i=void 0===a?{}:a,o=i.displayValue,c=void 0!==o&&o,s=i.excludeReferenceLink,u=void 0!==s&&s,l=i.fields,d=void 0===l?[]:l,p=i.queryNoDomain,f=void 0!==p&&p,h=i.view,v=void 0===h?"":h;return n(this,void 0,void 0,function(){var n,a;return r(this,function(r){switch(r.label){case 0:return n=["sysparm_display_value="+c,"sysparm_exclude_reference_link="+u,"sysparm_fields="+d.join(),"sysparm_query_no_domain="+f,"sysparm_view="+v].join("&"),[4,fetch(this.tableEndpoint+"/"+e+"/"+t+"?"+n,{method:"GET",headers:this.defaultHeaders})];case 1:return a=r.sent(),[4,this.handleResponse(a)];case 2:return[2,r.sent()]}})})},e.prototype.createRecord=function(e,t,a){var i=void 0===a?{}:a,o=i.displayValue,c=void 0!==o&&o,s=i.fields,u=void 0===s?[]:s,l=i.excludeReferenceLink,d=void 0!==l&&l,p=i.inputDisplayValue,f=void 0!==p&&p,h=i.view,v=void 0===h?"":h;return n(this,void 0,void 0,function(){var t,n;return r(this,function(r){switch(r.label){case 0:return t=["sysparm_display_value="+c,"sysparm_fields="+u.join(),"sysparm_exclude_reference_link="+d,"sysparm_input_display_value="+f,"sysparm_view="+v].join("&"),[4,fetch(this.tableEndpoint+"/"+e+"?"+t,{method:"POST",headers:this.defaultHeaders})];case 1:return n=r.sent(),[4,this.handleResponse(n)];case 2:return[2,r.sent()]}})})},e.prototype.scriptedRestApi=function(e,t,a){var i=a.additionalHeaders,o=void 0===i?{}:i;return n(this,void 0,void 0,function(){var n,a;return r(this,function(r){switch(r.label){case 0:for(a in n=new Headers(this.defaultHeaders),o)n.set(a,o[a]);return console.log(JSON.stringify(n)),[4,fetch(this.endpoint+"/"+e,{method:t,headers:n})];case 1:return[2,r.sent()]}})})},e}();t.default=a}).call(this,n(43).Buffer)},25:function(e,t,n){e.exports=n(47)},35:function(e,t){},47:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),i=n(20),o=n.n(i),c=n(21),s=n(7),u=n(9),l=n(10),d=function(){return a.a.createElement("div",null,a.a.createElement("h1",null,"Home"),a.a.createElement(l.b,{to:"/incidents"},"Incidents"))},p=n(2),f=n.n(p),h=n(6),v=n(24),m=n.n(v),y=Object(r.createContext)(),b=function(){return Object(r.useContext)(y)},w=n(12),E=n.n(w),_=function(){var e=Object(h.a)(f.a.mark(function e(){var t,n,r,a,i;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=localStorage.getItem("token"),n="dev72041",t){e.next=4;break}return e.abrupt("return",!1);case 4:return e.prev=4,r=new E.a({token:t,instance:n}),e.next=8,r.scriptedRestApi("api/146223/auth_check","GET",{headers:{Accept:"application/json"}});case 8:if((a=e.sent).ok){e.next=12;break}return console.log("Response failed.",a.statusText),e.abrupt("return",!1);case 12:return e.next=14,a.json();case 14:return i=e.sent,e.abrupt("return",i);case 18:return e.prev=18,e.t0=e.catch(4),e.abrupt("return",!1);case 21:case"end":return e.stop()}},e,null,[[4,18]])}));return function(){return e.apply(this,arguments)}}(),g=new m.a({clientId:"708e03d320033300941bb03db73a7eff",clientSecret:"Nl;Uz,&Hh]",accessTokenUri:"https://dev72041.service-now.com/oauth_token.do",authorizationUri:"https://dev72041.service-now.com/oauth_auth.do",redirectUri:"http://localhost:3000/auth/callback",state:"keyboard-cat"}),k=function(){var e=Object(h.a)(f.a.mark(function e(t){var n;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g.token.getToken(t);case 3:return n=e.sent,window.localStorage.setItem("token",n.accessToken),e.abrupt("return",!0);case 8:return e.prev=8,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",!1);case 12:case"end":return e.stop()}},e,null,[[0,8]])}));return function(t){return e.apply(this,arguments)}}(),j=function(){window.localStorage.removeItem("token")},x=g.token.getUri(),O=function(){return Object(r.useEffect)(function(){Object(h.a)(f.a.mark(function e(){return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k(window.location);case 2:window.location="/";case 3:case"end":return e.stop()}},e)}))()},[]),a.a.createElement("div",null,a.a.createElement("h1",null,"Redirecting..."))},R=function(){var e=b(),t=(Object(s.a)(e,1)[0].authenticated,Object(r.useState)([])),n=Object(s.a)(t,2),i=n[0],o=n[1],c=Object(r.useState)(!0),u=Object(s.a)(c,2),l=u[0],d=u[1];return Object(r.useEffect)(function(){Object(h.a)(f.a.mark(function e(){var t,n;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new E.a({token:window.localStorage.getItem("token"),instance:"dev72041"}),e.next=3,t.getRecords("incident",{fields:["number","short_description"],limit:2,query:"active=true"});case 3:n=e.sent,o(n),d(!1);case 6:case"end":return e.stop()}},e)}))()},[]),a.a.createElement("div",null,a.a.createElement("code",null,l?"Loading...":JSON.stringify(i,null,2)))},S=function(){var e=b(),t=Object(s.a)(e,2),n=t[0],r=n.authenticated,i=n.user,o=t[1],c=function(){o({type:"signOut"})};return r?a.a.createElement("div",null,a.a.createElement("span",null,"Hello, ",i.name),a.a.createElement("a",{href:"#",onClick:c},"Sign out")):a.a.createElement("div",null,a.a.createElement("a",{href:x},"Sign in"))},H=function(){var e=b(),t=Object(s.a)(e,2),n=t[0],i=(n.authenticated,n.user,t[1]),o=function(){var e=Object(h.a)(f.a.mark(function e(){var t;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_();case 2:(t=e.sent)?(console.log("got user data",t),i({type:"signIn",user:t.result})):(console.log("didnt get user data, signing out"),i({type:"signOut"}));case 4:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}();return Object(r.useEffect)(function(){o()},[]),a.a.createElement("div",null,"authenticator")},I=function(){return a.a.createElement("div",null,a.a.createElement("h1",null,"You're Unauthorized"))},T=function(){var e=b(),t=Object(s.a)(e,1)[0].authenticated;return a.a.createElement(l.a,null,a.a.createElement(H,null),a.a.createElement("div",null,a.a.createElement(S,null),a.a.createElement("nav",null,a.a.createElement("ul",null,a.a.createElement("li",null,a.a.createElement(l.b,{to:"/"},"Home")),a.a.createElement("li",null,a.a.createElement(l.b,{to:"/incidents"},"Incidents")))),a.a.createElement(u.a,{path:"/",exact:!0,component:d}),a.a.createElement(function(e){var n=e.component,r=Object(c.a)(e,["component"]);return a.a.createElement(u.a,Object.assign({},r,{render:function(e){return t?a.a.createElement(n,e):a.a.createElement(I,null)}}))},{path:"/incidents",component:R}),a.a.createElement(u.a,{path:"/auth/callback",exact:!0,component:O})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(a.a.createElement(function(e){var t=e.children;return a.a.createElement(y.Provider,{value:Object(r.useReducer)(function(e,t){switch(t.type){case"signIn":return{authenticated:!0,user:t.user};case"signOut":return j(),{authenticated:!1,user:null};default:return e}},{authenticated:!1,user:null})},t)},null,a.a.createElement(T,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[25,1,2]]]);
//# sourceMappingURL=main.c37732c9.chunk.js.map