(window["webpackJsonpreact-sn"]=window["webpackJsonpreact-sn"]||[]).push([[0],{12:function(e,t,n){"use strict";(function(e){var n=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(a,o){function i(e){try{c(r.next(e))}catch(t){o(t)}}function s(e){try{c(r.throw(e))}catch(t){o(t)}}function c(e){e.done?a(e.value):new n(function(t){t(e.value)}).then(i,s)}c((r=r.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=(a=i.trys).length>0&&a[a.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(s){o=[6,s],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e){var t=e.token,n=e.instance;this.instance=n,this.endpoint="https://"+this.instance+".service-now.com",this.tableEndpoint="https://"+this.instance+".service-now.com/api/now/table",this.defaultHeaders=new Headers({"Content-Type":"application/json",Authorization:"Bearer "+t})}return e.prototype.handleResponse=function(e){return n(this,void 0,void 0,function(){var t,n;return r(this,function(r){switch(r.label){case 0:return e.ok?[4,e.json()]:[3,2];case 1:return[2,(t=r.sent()).result];case 2:return r.trys.push([2,4,,5]),[4,e.json()];case 3:return t=r.sent(),console.error("ServiceNow returned error "+e.status+":\n"+JSON.stringify(t,null,2)),[2,null];case 4:return n=r.sent(),console.error("Error attempting to parse response. \n"+n),[2,null];case 5:return[2]}})})},e.prototype.getRecords=function(e,t){var a=t.displayValue,o=void 0!==a&&a,i=t.excludeReferenceLink,s=void 0!==i&&i,c=t.fields,u=void 0===c?[]:c,l=t.limit,d=void 0===l?1e4:l,p=t.offset,f=void 0===p?0:p,h=t.query,v=void 0===h?"":h,m=t.queryNoDomain,w=void 0!==m&&m,y=t.suppressPaginationHeader,b=void 0!==y&&y,E=t.view,g=void 0===E?"":E;return n(this,void 0,void 0,function(){var t,n;return r(this,function(r){switch(r.label){case 0:return t=["sysparm_display_value="+o,"sysparm_exclude_reference_link="+s,"sysparm_fields="+u.join(),"sysparm_limit="+d,"sysparm_offset="+f,"sysparm_query="+v,"sysparm_query_no_domain="+w,"sysparm_suppress_pagination_header="+b,"sysparm_view="+g].join("&"),[4,fetch(this.tableEndpoint+"/"+e+"?"+t,{method:"GET",headers:this.defaultHeaders})];case 1:return n=r.sent(),[4,this.handleResponse(n)];case 2:return[2,r.sent()]}})})},e.prototype.getRecord=function(e,t,a){var o=void 0===a?{}:a,i=o.displayValue,s=void 0!==i&&i,c=o.excludeReferenceLink,u=void 0!==c&&c,l=o.fields,d=void 0===l?[]:l,p=o.queryNoDomain,f=void 0!==p&&p,h=o.view,v=void 0===h?"":h;return n(this,void 0,void 0,function(){var n,a;return r(this,function(r){switch(r.label){case 0:return n=["sysparm_display_value="+s,"sysparm_exclude_reference_link="+u,"sysparm_fields="+d.join(),"sysparm_query_no_domain="+f,"sysparm_view="+v].join("&"),[4,fetch(this.tableEndpoint+"/"+e+"/"+t+"?"+n,{method:"GET",headers:this.defaultHeaders})];case 1:return a=r.sent(),[4,this.handleResponse(a)];case 2:return[2,r.sent()]}})})},e.prototype.createRecord=function(e,t,a){var o=void 0===a?{}:a,i=o.displayValue,s=void 0!==i&&i,c=o.fields,u=void 0===c?[]:c,l=o.excludeReferenceLink,d=void 0!==l&&l,p=o.inputDisplayValue,f=void 0!==p&&p,h=o.view,v=void 0===h?"":h;return n(this,void 0,void 0,function(){var t,n;return r(this,function(r){switch(r.label){case 0:return t=["sysparm_display_value="+s,"sysparm_fields="+u.join(),"sysparm_exclude_reference_link="+d,"sysparm_input_display_value="+f,"sysparm_view="+v].join("&"),[4,fetch(this.tableEndpoint+"/"+e+"?"+t,{method:"POST",headers:this.defaultHeaders})];case 1:return n=r.sent(),[4,this.handleResponse(n)];case 2:return[2,r.sent()]}})})},e.prototype.scriptedRestApi=function(e,t,a){var o=a.additionalHeaders,i=void 0===o?{}:o;return n(this,void 0,void 0,function(){var n,a;return r(this,function(r){switch(r.label){case 0:for(a in n=new Headers(this.defaultHeaders),i)n.set(a,i[a]);return console.log(JSON.stringify(n)),[4,fetch(this.endpoint+"/"+e,{method:t,headers:n})];case 1:return[2,r.sent()]}})})},e}();t.default=a}).call(this,n(43).Buffer)},25:function(e,t,n){e.exports=n(47)},35:function(e,t){},47:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),o=n(20),i=n.n(o),s=n(21),c=n(7),u=n(9),l=n(10),d=function(){return a.a.createElement("div",null,a.a.createElement("h1",null,"Home"),a.a.createElement(l.b,{to:"/incidents"},"Incidents"))},p=n(2),f=n.n(p),h=n(6),v=n(24),m=n.n(v),w=Object(r.createContext)(),y=function(){return Object(r.useContext)(w)},b=n(12),E=n.n(b),g=function(){var e=Object(h.a)(f.a.mark(function e(){var t,n,r,a,o;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=localStorage.getItem("token"),n="dev72041",t){e.next=4;break}return e.abrupt("return",!1);case 4:return e.prev=4,r=new E.a({token:t,instance:n}),e.next=8,r.scriptedRestApi("api/146223/auth_check","GET",{headers:{Accept:"application/json"}});case 8:if((a=e.sent).ok){e.next=12;break}return console.log("Response failed.",a.statusText),e.abrupt("return",!1);case 12:return e.next=14,a.json();case 14:return o=e.sent,e.abrupt("return",o);case 18:return e.prev=18,e.t0=e.catch(4),e.abrupt("return",!1);case 21:case"end":return e.stop()}},e,null,[[4,18]])}));return function(){return e.apply(this,arguments)}}(),_=new m.a({clientId:"708e03d320033300941bb03db73a7eff",accessTokenUri:"https://dev72041.service-now.com/oauth_token.do",authorizationUri:"https://dev72041.service-now.com/oauth_auth.do",redirectUri:"http://localhost:3000/auth/callback",state:"keyboard-cat"}),k=function(){var e=Object(h.a)(f.a.mark(function e(t){var n;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,_.token.getToken(t);case 3:return n=e.sent,window.localStorage.setItem("token",n.accessToken),e.abrupt("return",!0);case 8:return e.prev=8,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",!1);case 12:case"end":return e.stop()}},e,null,[[0,8]])}));return function(t){return e.apply(this,arguments)}}(),j=function(){window.localStorage.removeItem("token")},x=_.token.getUri(),O=function(){return Object(r.useEffect)(function(){Object(h.a)(f.a.mark(function e(){var t;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k(window.location);case 2:t=window.sessionStorage.getItem("savedUrl")||"/",window.location=t;case 4:case"end":return e.stop()}},e)}))()},[]),a.a.createElement("div",null,a.a.createElement("h1",null,"Redirecting..."))},S=function(){var e=y(),t=(Object(c.a)(e,1)[0].authenticated,Object(r.useState)([])),n=Object(c.a)(t,2),o=n[0],i=n[1],s=Object(r.useState)(!0),u=Object(c.a)(s,2),l=u[0],d=u[1];return Object(r.useEffect)(function(){Object(h.a)(f.a.mark(function e(){var t,n;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new E.a({token:window.localStorage.getItem("token"),instance:"dev72041"}),e.next=3,t.getRecords("incident",{fields:["number","short_description"],limit:2,query:"active=true"});case 3:n=e.sent,i(n),d(!1);case 6:case"end":return e.stop()}},e)}))()},[]),a.a.createElement("div",null,a.a.createElement("code",null,l?"Loading...":JSON.stringify(o,null,2)))},R=function(){var e=y(),t=Object(c.a)(e,2),n=t[0],r=n.authenticated,o=n.user,i=t[1],s=function(e){e.preventDefault(),window.sessionStorage.setItem("savedUrl",window.location),window.location=x},u=function(e){e.preventDefault(),i({type:"signOut"})};return r?a.a.createElement("div",null,a.a.createElement("span",null,"Hello, ",o.name),a.a.createElement("button",{onClick:u},"Sign out")):a.a.createElement("div",null,a.a.createElement("button",{onClick:s},"Sign in"))},H=function(){var e=y(),t=Object(c.a)(e,2),n=t[0],o=(n.authenticated,n.user,t[1]),i=function(){var e=Object(h.a)(f.a.mark(function e(){var t;return f.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g();case 2:(t=e.sent)?(console.log("got user data",t),o({type:"signIn",user:t.result})):(console.log("didnt get user data, signing out"),o({type:"signOut"}));case 4:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}();return Object(r.useEffect)(function(){i()},[]),a.a.createElement("div",null,"authenticator")},I=function(){return a.a.createElement("div",null,a.a.createElement("h1",null,"You're Unauthorized"))},T=function(){var e=y(),t=Object(c.a)(e,1)[0].authenticated;return a.a.createElement(l.a,null,a.a.createElement(H,null),a.a.createElement("div",null,a.a.createElement(R,null),a.a.createElement("nav",null,a.a.createElement("ul",null,a.a.createElement("li",null,a.a.createElement(l.b,{to:"/"},"Home")),a.a.createElement("li",null,a.a.createElement(l.b,{to:"/incidents"},"Incidents")))),a.a.createElement(u.a,{path:"/",exact:!0,component:d}),a.a.createElement(function(e){var n=e.component,r=Object(s.a)(e,["component"]);return a.a.createElement(u.a,Object.assign({},r,{render:function(e){return t?a.a.createElement(n,e):a.a.createElement(I,null)}}))},{path:"/incidents",component:S}),a.a.createElement(u.a,{path:"/auth/callback",exact:!0,component:O})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(a.a.createElement(function(e){var t=e.children;return a.a.createElement(w.Provider,{value:Object(r.useReducer)(function(e,t){switch(t.type){case"signIn":return{authenticated:!0,user:t.user};case"signOut":return j(),{authenticated:!1,user:null};default:return e}},{authenticated:!1,user:null})},t)},null,a.a.createElement(T,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[25,1,2]]]);
//# sourceMappingURL=main.7eac3c8d.chunk.js.map